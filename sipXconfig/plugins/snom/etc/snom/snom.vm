## calculates setting permission based on its name
#macro( perm $setting )
#set ($pn = $!{setting.ProfileName})
#if ($pn.endsWith('$'))
perm="RW"#elseif ($pn.endsWith('!'))
perm="!"#else
perm="R"#end
#end
<?xml version="1.0"?>
<!-- sipXconfig autogenerated profile for snom Phones -->
<!--  Model $phone.Model.Label Maxlines $phone.Model.MaxLineCount -->
<settings>
	<phone-settings e="2">
#foreach ($group in $phone.Settings.Values)
#if ($group.Name != 'fkeys')
#foreach ($setting in $group.Values)
		<${setting.name} #perm( $setting )>$!{setting.Value}</${setting.name}>
#end
#end
#end
		<dkey_retrieve perm="R">speed 101</dkey_retrieve>

		<!-- speeddial list -->
#foreach ($number in $speedDial)
#set ($i = $velocityCount - 1)
		<speed idx="${i}" perm="R">$number</speed>
#end
		<!-- identities -->
#foreach ($line in $phone.ProfileLines)
#set ($i = $velocityCount)
#foreach ($group in $line.Values)
#foreach ($setting in $group.Values)
		<${setting.ProfileName} idx="${i}" #perm( $setting )>$!{setting.Value}</${setting.ProfileName}>
#end
#end
#end
	</phone-settings>

	<!-- address book -->
	<tbook e="2">
#foreach ($entry in $phoneBook)
#set ($i = $velocityCount - 1)
#set ($fullName = "$!{entry.FirstName} $!{entry.LastName}")
#set ($fullName = $fullName.trim())
		<item context="active" type="none" index="${i}">
			<name>$!fullName</name>
			<number>$!{entry.Number}</number>
			<search></search>
		</item>
#end
	</tbook>

	<!-- Function Keys -->
	<functionKeys e="2">
#foreach ($key in $phone.Settings.getSetting('fkeys').Values)
#set ($context = $key.getSetting('context').Value)
#set ($type = $key.getSetting('type').Value)
#set ($number = $key.getSetting('number').Value)
#set ($fkeyValue = "$!type $!number")
#set ($fkeyValue = $fkeyValue.trim())
#set ($i = $velocityCount - 1)
		<fkey idx="${i}" context="$context" perm="R">$!fkeyValue</fkey>
#end
	</functionKeys>
</settings>
