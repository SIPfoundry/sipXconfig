#!BuildIgnore: post-build-checks
Name: @PACKAGE@
Version: @VERSION@
Release: @PACKAGE_REVISION@

# do not build a debuginfo package
%define debug_package %{nil}

Summary: sipXecs Enterprise Communications Server 
License: LGPL
Group: Telecommunications
Vendor: SIPfoundry
Packager: SIPfoundry <sipx-dev@sipfoundry.org>
Url: http://www.sipfoundry.org

BuildRequires: automake

Requires: freeswitch >= 1.0.7
Requires: freeswitch-application-abstraction
Requires: freeswitch-application-avmd
Requires: freeswitch-application-blacklist
Requires: freeswitch-application-callcenter
Requires: freeswitch-application-cidlookup
Requires: freeswitch-application-conference
Requires: freeswitch-application-curl
Requires: freeswitch-application-db
Requires: freeswitch-application-directory
Requires: freeswitch-application-distributor
Requires: freeswitch-application-easyroute
Requires: freeswitch-application-esf
Requires: freeswitch-application-expr
Requires: freeswitch-application-fifo
Requires: freeswitch-application-fsk
Requires: freeswitch-application-fsv
Requires: freeswitch-application-hash
Requires: freeswitch-application-httapi
Requires: freeswitch-application-http-cache
Requires: freeswitch-application-lcr
Requires: freeswitch-application-limit
Requires: freeswitch-application-memcache
Requires: freeswitch-application-nibblebill
Requires: freeswitch-application-redis
Requires: freeswitch-application-rss
Requires: freeswitch-application-sms
Requires: freeswitch-application-snapshot
Requires: freeswitch-application-snom
Requires: freeswitch-application-soundtouch
Requires: freeswitch-application-spy
Requires: freeswitch-application-stress
Requires: freeswitch-application-valet_parking
Requires: freeswitch-application-voicemail
Requires: freeswitch-application-voicemail-ivr
Requires: freeswitch-asrtts-flite
Requires: freeswitch-asrtts-pocketsphinx
Requires: freeswitch-asrtts-tts-commandline
Requires: freeswitch-asrtts-unimrcp
Requires: freeswitch-codec-bv
Requires: freeswitch-codec-celt
Requires: freeswitch-codec-codec2
Requires: freeswitch-codec-h26x
Requires: freeswitch-codec-ilbc
Requires: freeswitch-codec-isac
Requires: freeswitch-codec-mp4v
Requires: freeswitch-codec-opus
Requires: freeswitch-codec-passthru-amr
Requires: freeswitch-codec-passthru-amrwb
Requires: freeswitch-codec-passthru-g723_1 
Requires: freeswitch-codec-passthru-g729
Requires: freeswitch-codec-silk
Requires: freeswitch-codec-siren
Requires: freeswitch-codec-theora
Requires: freeswitch-codec-vp8
Requires: freeswitch-config-vanilla
Requires: freeswitch-endpoint-dingaling
Requires: freeswitch-endpoint-portaudio
Requires: freeswitch-endpoint-rtmp
Requires: freeswitch-endpoint-skinny
Requires: freeswitch-endpoint-skypopen
Requires: freeswitch-event-cdr-sqlite
Requires: freeswitch-event-json-cdr
Requires: freeswitch-event-multicast
Requires: freeswitch-event-rayo
Requires: freeswitch-format-local-stream
Requires: freeswitch-format-mod-shout
Requires: freeswitch-format-native-file
Requires: freeswitch-format-portaudio-stream
Requires: freeswitch-format-shell-stream
Requires: freeswitch-format-ssml
Requires: freeswitch-format-tone-stream
Requires: freeswitch-timer-posix
Requires: freeswitch-xml-cdr
Requires: freeswitch-xml-curl
Requires: oss_core-app >= %version
Requires: sipxacccode-ng >= %version
Requires: sipxcallcontroller-ng >= %version
Requires: sipxcdr-ng >= %version
Requires: sipxcdrlog-ng >= %version
Requires: sipxconfig-ng >= %version
Requires: sipxconfig-ng-ftp >= %version
Requires: sipxconfig-ng-tftp >= %version
Requires: sipxivr-ng >= %version
Requires: sipxaudiocodes-ng >= %version
Requires: sipxcounterpath-ng >= %version
Requires: sipxgrandstream-ng >= %version
Requires: sipxpolycom-ng >= %version
Requires: sipxyealink-ng >= %version
Requires: sipxcisco-ng >= %version
Requires: sipxprovision-ng >= %version
Requires: sipxproxy-ng >= %version
Requires: sipxpublisher-ng >= %version
Requires: sipxrecording-ng >= %version
Requires: sipxregistry-ng >= %version
Requires: sipxrelease-ng >= %version
Requires: sipxrest-ng >= %version
Requires: sipxsupervisor-ng >= %version

Obsoletes: %{name}-doc

Source: %name-%version.tar.gz

Prefix: %_prefix
BuildRoot: %{_tmppath}/%name-%version-root

%description
sipXecs is an IP PBX with integrated voice mail, ACD, multiple auto attendents, and web-based system configuration and management tool.

%prep
%setup -q
# suse and obs build system
mv %{_builddir}/%name-%version/%name-rpmlintrc %{_sourcedir}

%pre
# NOTE: Duplicate copy of user/group add in sipXcommons
if ! /usr/bin/id -g sipx >/dev/null 2>&1; then
  /usr/sbin/groupadd -r sipx
fi

if ! /usr/bin/id sipx >/dev/null 2>&1; then
  # hack: use "-s /bin/bash", some scripts need to be fixed to not require that
  /usr/sbin/useradd -M -r -g sipx -d %{_sysconfdir}/sipxpbx -s /bin/bash -c sipx sipx 2>&1
fi

%build
%configure @SIPX_RPM_CONFIGURE_OPTIONS@
make

%install
rm -rf $RPM_BUILD_ROOT
make DESTDIR=$RPM_BUILD_ROOT install

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(644,root,root,755)

%post

%preun
